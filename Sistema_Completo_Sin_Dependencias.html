<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Asistencia - Versi√≥n Completa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: inline-block;
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .module-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .module-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .module-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 24px;
            color: white;
        }

        .module-title {
            font-size: 1.5rem;
            color: #2c3e50;
            font-weight: bold;
        }

        .file-upload {
            margin-bottom: 20px;
        }

        .file-input {
            width: 100%;
            padding: 15px;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .file-input:hover {
            border-color: #667eea;
            background: #e8f2ff;
        }

        .file-input.dragover {
            border-color: #27ae60;
            background: #e8f5e8;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .export-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 5px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Sistema de Gesti√≥n de Asistencia</h1>
            <p>Versi√≥n Completa - Procesamiento Real de Excel</p>
            <div class="status-indicator">‚úÖ Sistema Operativo</div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('alumbrado')">üè¢ Alumbrado P√∫blico</div>
            <div class="tab" onclick="showTab('alcaldia')">üèõÔ∏è Alcald√≠a</div>
            <div class="tab" onclick="showTab('enviaseo')">üå± Enviaseo</div>
        </div>

        <!-- M√≥dulo Alumbrado P√∫blico -->
        <div id="alumbrado" class="tab-content active">
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon">üè¢</div>
                    <div class="module-title">Alumbrado P√∫blico - Control de Asistencia</div>
                </div>

                <div class="file-upload">
                    <input type="file" id="alumbradoFile" accept=".xlsx,.xls" class="file-input" onchange="handleFileUpload('alumbrado', this)">
                    <p>üìÅ Arrastra y suelta archivos Excel aqu√≠ o haz clic para seleccionar</p>
                </div>

                <div class="loading" id="alumbradoLoading">
                    <div class="spinner"></div>
                    <p>Procesando archivo Excel...</p>
                </div>

                <div id="alumbradoAlert"></div>

                <div class="stats-grid" id="alumbradoStats"></div>

                <div class="export-section">
                    <h3>üìä Datos Procesados</h3>
                    <button class="btn btn-success" onclick="exportToExcel('alumbrado')">üì• Exportar a Excel</button>
                    <button class="btn" onclick="exportToCSV('alumbrado')">üìÑ Exportar a CSV</button>
                    <button class="btn btn-danger" onclick="clearData('alumbrado')">üóëÔ∏è Limpiar Datos</button>
                </div>

                <table class="data-table" id="alumbradoTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>C√©dula</th>
                            <th>Fecha</th>
                            <th>Hora Entrada</th>
                            <th>Hora Salida</th>
                            <th>Horas Trabajadas</th>
                            <th>Horas Extra</th>
                        </tr>
                    </thead>
                    <tbody id="alumbradoTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- M√≥dulo Alcald√≠a -->
        <div id="alcaldia" class="tab-content">
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon">üèõÔ∏è</div>
                    <div class="module-title">Alcald√≠a - Gesti√≥n de Empleados</div>
                </div>

                <div class="file-upload">
                    <input type="file" id="alcaldiaFile" accept=".xlsx,.xls" class="file-input" onchange="handleFileUpload('alcaldia', this)">
                    <p>üìÅ Arrastra y suelta archivos Excel aqu√≠ o haz clic para seleccionar</p>
                </div>

                <div class="loading" id="alcaldiaLoading">
                    <div class="spinner"></div>
                    <p>Procesando archivo Excel...</p>
                </div>

                <div id="alcaldiaAlert"></div>

                <div class="stats-grid" id="alcaldiaStats"></div>

                <div class="export-section">
                    <h3>üìä Datos Procesados</h3>
                    <button class="btn btn-success" onclick="exportToExcel('alcaldia')">üì• Exportar a Excel</button>
                    <button class="btn" onclick="exportToCSV('alcaldia')">üìÑ Exportar a CSV</button>
                    <button class="btn btn-danger" onclick="clearData('alcaldia')">üóëÔ∏è Limpiar Datos</button>
                </div>

                <table class="data-table" id="alcaldiaTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>C√©dula</th>
                            <th>Fecha</th>
                            <th>Hora Entrada</th>
                            <th>Hora Salida</th>
                            <th>Horas Trabajadas</th>
                            <th>Horas Extra</th>
                        </tr>
                    </thead>
                    <tbody id="alcaldiaTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- M√≥dulo Enviaseo -->
        <div id="enviaseo" class="tab-content">
            <div class="module-card">
                <div class="module-header">
                    <div class="module-icon">üå±</div>
                    <div class="module-title">Enviaseo - Control de Acceso</div>
                </div>

                <div class="file-upload">
                    <input type="file" id="enviaseoFile" accept=".xlsx,.xls" class="file-input" onchange="handleFileUpload('enviaseo', this)">
                    <p>üìÅ Arrastra y suelta archivos Excel aqu√≠ o haz clic para seleccionar</p>
                </div>

                <div class="loading" id="enviaseoLoading">
                    <div class="spinner"></div>
                    <p>Procesando archivo Excel...</p>
                </div>

                <div id="enviaseoAlert"></div>

                <div class="stats-grid" id="enviaseoStats"></div>

                <div class="export-section">
                    <h3>üìä Datos Procesados</h3>
                    <button class="btn btn-success" onclick="exportToExcel('enviaseo')">üì• Exportar a Excel</button>
                    <button class="btn" onclick="exportToCSV('enviaseo')">üìÑ Exportar a CSV</button>
                    <button class="btn btn-danger" onclick="clearData('enviaseo')">üóëÔ∏è Limpiar Datos</button>
                </div>

                <table class="data-table" id="enviaseoTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>C√©dula</th>
                            <th>Fecha</th>
                            <th>Hora Entrada</th>
                            <th>Hora Salida</th>
                            <th>Horas Trabajadas</th>
                            <th>Horas Extra</th>
                        </tr>
                    </thead>
                    <tbody id="enviaseoTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n del sistema
        const JORNADA_LABORAL_HORAS = 8;
        const STORAGE_PREFIX = 'sistema_asistencia_';

        // Datos globales
        let currentData = {
            alumbrado: [],
            alcaldia: [],
            enviaseo: []
        };

        // Cargar datos guardados al iniciar
        loadSavedData();

        function showTab(tabName) {
            // Ocultar todas las pesta√±as
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Mostrar la pesta√±a seleccionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function handleFileUpload(module, fileInput) {
            const file = fileInput.files[0];
            if (!file) return;

            if (!file.name.match(/\.(xlsx|xls)$/)) {
                showAlert(module, 'error', 'Por favor selecciona un archivo Excel v√°lido (.xlsx o .xls)');
                return;
            }

            showLoading(module, true);
            showAlert(module, 'info', 'Procesando archivo Excel...');

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    const processedData = processExcelData(workbook, module);
                    currentData[module] = processedData;
                    
                    saveData(module);
                    displayData(module);
                    showAlert(module, 'success', `‚úÖ Archivo procesado exitosamente. ${processedData.length} registros encontrados.`);
                    
                } catch (error) {
                    console.error('Error procesando Excel:', error);
                    showAlert(module, 'error', 'Error procesando el archivo Excel: ' + error.message);
                } finally {
                    showLoading(module, false);
                }
            };

            reader.readAsArrayBuffer(file);
        }

        function processExcelData(workbook, module) {
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

            if (jsonData.length < 2) {
                throw new Error('El archivo Excel no contiene datos suficientes');
            }

            const headers = jsonData[0];
            const dataRows = jsonData.slice(1);

            // Detectar columnas autom√°ticamente
            const columnMap = detectColumns(headers, module);
            
            const processedData = [];
            const personMap = new Map();

            dataRows.forEach((row, index) => {
                if (!row || row.length === 0) return;

                try {
                    const record = {
                        nombre: getColumnValue(row, columnMap.nombre) || '',
                        apellido: getColumnValue(row, columnMap.apellido) || '',
                        cedula: getColumnValue(row, columnMap.cedula) || '',
                        fecha: getColumnValue(row, columnMap.fecha) || '',
                        hora: getColumnValue(row, columnMap.hora) || '',
                        tipo_asistencia: getColumnValue(row, columnMap.tipo_asistencia) || ''
                    };

                    if (!record.cedula || !record.fecha) return;

                    const key = `${record.cedula}-${record.fecha}`;
                    if (!personMap.has(key)) {
                        personMap.set(key, {
                            nombre: record.nombre,
                            apellido: record.apellido,
                            cedula: record.cedula,
                            fecha: record.fecha,
                            registros: []
                        });
                    }

                    personMap.get(key).registros.push({
                        hora: record.hora,
                        tipo_asistencia: record.tipo_asistencia
                    });

                } catch (error) {
                    console.warn(`Error procesando fila ${index + 2}:`, error);
                }
            });

            // Procesar cada persona y calcular horas
            personMap.forEach(person => {
                const checkIns = person.registros
                    .filter(r => esEntrada(r.tipo_asistencia))
                    .sort((a, b) => a.hora.localeCompare(b.hora));

                const checkOuts = person.registros
                    .filter(r => esSalida(r.tipo_asistencia))
                    .sort((a, b) => b.hora.localeCompare(a.hora));

                const primerCheckIn = checkIns[0]?.hora || null;
                const ultimoCheckOut = checkOuts[0]?.hora || null;

                let horasTrabajadas = null;
                let horasExtra = null;

                if (primerCheckIn && ultimoCheckOut) {
                    const horas = calcularHoras(primerCheckIn, ultimoCheckOut);
                    horasTrabajadas = horas.total;
                    horasExtra = Math.max(0, horas.total - JORNADA_LABORAL_HORAS);
                }

                processedData.push({
                    nombre: person.nombre,
                    apellido: person.apellido,
                    cedula: person.cedula,
                    fecha: person.fecha,
                    horaCheckin: primerCheckIn,
                    horaCheckout: ultimoCheckOut,
                    horasTrabajadas: horasTrabajadas,
                    horasExtra: horasExtra
                });
            });

            return processedData;
        }

        function detectColumns(headers, module) {
            const columnMap = {
                nombre: -1,
                apellido: -1,
                cedula: -1,
                fecha: -1,
                hora: -1,
                tipo_asistencia: -1
            };

            headers.forEach((header, index) => {
                if (!header) return;
                
                const headerLower = header.toString().toLowerCase();
                
                if (headerLower.includes('nombre') && !headerLower.includes('apellido')) {
                    columnMap.nombre = index;
                } else if (headerLower.includes('apellido') || headerLower.includes('lastname')) {
                    columnMap.apellido = index;
                } else if (headerLower.includes('cedula') || headerLower.includes('documento') || headerLower.includes('id')) {
                    columnMap.cedula = index;
                } else if (headerLower.includes('fecha') || headerLower.includes('date')) {
                    columnMap.fecha = index;
                } else if (headerLower.includes('hora') || headerLower.includes('time')) {
                    columnMap.hora = index;
                } else if (headerLower.includes('tipo') || headerLower.includes('asistencia') || headerLower.includes('entrada') || headerLower.includes('salida')) {
                    columnMap.tipo_asistencia = index;
                }
            });

            return columnMap;
        }

        function getColumnValue(row, columnIndex) {
            if (columnIndex === -1 || !row[columnIndex]) return '';
            return row[columnIndex].toString().trim();
        }

        function esEntrada(tipo) {
            if (!tipo) return false;
            const tipoLower = tipo.toLowerCase();
            return tipoLower.includes('entrada') || tipoLower.includes('check in') || tipoLower.includes('in') || tipoLower.includes('ingreso');
        }

        function esSalida(tipo) {
            if (!tipo) return false;
            const tipoLower = tipo.toLowerCase();
            return tipoLower.includes('salida') || tipoLower.includes('check out') || tipoLower.includes('out') || tipoLower.includes('egreso');
        }

        function calcularHoras(horaInicio, horaFin) {
            const [h1, m1] = horaInicio.split(':').map(Number);
            const [h2, m2] = horaFin.split(':').map(Number);
            
            let diff = h2 + m2 / 60 - (h1 + m1 / 60);
            if (diff < 0) diff += 24; // Manejar cambio de d√≠a
            
            return {
                total: Math.round(diff * 100) / 100,
                horas: Math.floor(diff),
                minutos: Math.round((diff % 1) * 60)
            };
        }

        function displayData(module) {
            const data = currentData[module];
            const tableBody = document.getElementById(`${module}TableBody`);
            const table = document.getElementById(`${module}Table`);
            const statsContainer = document.getElementById(`${module}Stats`);

            // Limpiar tabla
            tableBody.innerHTML = '';

            if (data.length === 0) {
                table.style.display = 'none';
                statsContainer.innerHTML = '<div class="stat-card"><div class="stat-number">0</div><div class="stat-label">Registros</div></div>';
                return;
            }

            // Mostrar tabla
            table.style.display = 'table';

            // Llenar tabla
            data.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.nombre}</td>
                    <td>${record.apellido}</td>
                    <td>${record.cedula}</td>
                    <td>${record.fecha}</td>
                    <td>${record.horaCheckin || '-'}</td>
                    <td>${record.horaCheckout || '-'}</td>
                    <td>${record.horasTrabajadas ? record.horasTrabajadas.toFixed(2) + 'h' : '-'}</td>
                    <td>${record.horasExtra ? record.horasExtra.toFixed(2) + 'h' : '-'}</td>
                `;
                tableBody.appendChild(row);
            });

            // Mostrar estad√≠sticas
            const totalRegistros = data.length;
            const totalHorasTrabajadas = data.reduce((sum, record) => sum + (record.horasTrabajadas || 0), 0);
            const totalHorasExtra = data.reduce((sum, record) => sum + (record.horasExtra || 0), 0);
            const personasUnicas = new Set(data.map(record => record.cedula)).size;

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalRegistros}</div>
                    <div class="stat-label">Registros</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${personasUnicas}</div>
                    <div class="stat-label">Personas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalHorasTrabajadas.toFixed(1)}h</div>
                    <div class="stat-label">Horas Trabajadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalHorasExtra.toFixed(1)}h</div>
                    <div class="stat-label">Horas Extra</div>
                </div>
            `;
        }

        function showAlert(module, type, message) {
            const alertContainer = document.getElementById(`${module}Alert`);
            alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        function showLoading(module, show) {
            const loadingElement = document.getElementById(`${module}Loading`);
            loadingElement.style.display = show ? 'block' : 'none';
        }

        function saveData(module) {
            try {
                localStorage.setItem(`${STORAGE_PREFIX}${module}`, JSON.stringify(currentData[module]));
            } catch (error) {
                console.error('Error guardando datos:', error);
            }
        }

        function loadSavedData() {
            ['alumbrado', 'alcaldia', 'enviaseo'].forEach(module => {
                try {
                    const savedData = localStorage.getItem(`${STORAGE_PREFIX}${module}`);
                    if (savedData) {
                        currentData[module] = JSON.parse(savedData);
                        displayData(module);
                    }
                } catch (error) {
                    console.error(`Error cargando datos de ${module}:`, error);
                }
            });
        }

        function exportToExcel(module) {
            const data = currentData[module];
            if (data.length === 0) {
                showAlert(module, 'error', 'No hay datos para exportar');
                return;
            }

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Datos');
            
            const fileName = `Sistema_Asistencia_${module}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showAlert(module, 'success', '‚úÖ Archivo Excel exportado exitosamente');
        }

        function exportToCSV(module) {
            const data = currentData[module];
            if (data.length === 0) {
                showAlert(module, 'error', 'No hay datos para exportar');
                return;
            }

            const headers = ['Nombre', 'Apellido', 'C√©dula', 'Fecha', 'Hora Entrada', 'Hora Salida', 'Horas Trabajadas', 'Horas Extra'];
            const csvContent = [
                headers.join(','),
                ...data.map(record => [
                    record.nombre,
                    record.apellido,
                    record.cedula,
                    record.fecha,
                    record.horaCheckin || '',
                    record.horaCheckout || '',
                    record.horasTrabajadas ? record.horasTrabajadas.toFixed(2) : '',
                    record.horasExtra ? record.horasExtra.toFixed(2) : ''
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Sistema_Asistencia_${module}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert(module, 'success', '‚úÖ Archivo CSV exportado exitosamente');
        }

        function clearData(module) {
            if (confirm(`¬øEst√°s seguro de que quieres limpiar todos los datos de ${module}?`)) {
                currentData[module] = [];
                saveData(module);
                displayData(module);
                showAlert(module, 'success', '‚úÖ Datos limpiados exitosamente');
            }
        }

        // Drag and drop functionality
        document.addEventListener('DOMContentLoaded', function() {
            const fileInputs = document.querySelectorAll('.file-input');
            
            fileInputs.forEach(input => {
                input.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                input.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });
                
                input.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.files = files;
                        const module = this.id.replace('File', '');
                        handleFileUpload(module, this);
                    }
                });
            });
        });
    </script>
</body>
</html>
